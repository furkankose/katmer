#file: noinspection YAMLDuplicatedKeys
targets:
  environment:
    ASD: 123
  hosts:
    local:
      connection: local
    host_1:
      connection: ssh
      hostname: 192.168.1.102
      port: 22
      username: plusauth
      password: 1234

defaults:
  targets: local

tasks:
  - name: gatherfacst
    gather_facts: true
    targets: local
#  # 1) Fetch once on the controller (local machine)
#  - name: Fetch artifact locally
#    targets: host_1
#    http:
#      url: "https://raw.githubusercontent.com/PlusAuth/oidc-client-js/refs/heads/main/jest.config.js"
#      output: "./dist/fastfetch-linux.zip"
#
#  # 2) Copy the fetched file to your target machines
#  - name: Copy artifact to targets
#    targets: host_1
#    become: true
#    copy:
#      src: "./dist/fastfetch-linux.zip"        # path on controller
#      dest: "/opt/app/fastfetch-linux.zip"     # path on target
#      mode: "0644"
#      backup: true
#  - name: Unzip artifact on targets
#    targets: host_1
#    become: true
#    script: unzip -o /opt/app/fastfetch-linux.zip -d /opt/app/fastfetch/
#  - name: print env
#    targets: local
#    environment:
#      ASD: 123
#    debug: "asdasd ( {{ lookup('env', 'ComSpec', {default:'213123'}) }} )"
#tasks:
#  - name: Probe multiple endpoints
#    targets: local
#    loop:
#      for:
#        - https://a.example.com/health
#        - https://b.example.com/health
#        - https://c.example.com/health
#    register: probes
#    http:
#      url: "{{ item }}"
#      timeout: 3
#      fail_on_http_error: false
#
#  - name: Inspect the aggregated loop result
#    targets: local
#    debug:
#      label: "probes.results (one entry per iteration)"
#      var: [ "probes.results" ]
#
#  - name: Report only failures (reads each iteration's item)
#    targets: local
#    debug:
#      msg: |
#        Failing endpoints:
#        {% for r in probes.results %}
#        {% if r.status != 200 %}- {{ r.item }} (status={{ r.status|default('n/a') }}){% endif %}
#        {% endfor %}
