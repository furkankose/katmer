{
  "name": "gather_facts",
  "constraints": {
    "platform": {
      "any": true
    }
  },
  "source": "C:/Users/ayz/ws-webstorm/katmer/packages/core/modules/gather_facts.module.ts",
  "description": "Gather target facts using the [**fastfetch** CLI](https://github.com/fastfetch-cli/fastfetch) (zero external deps on the target).",
  "remarks": "- The module **fetches a prebuilt fastfetch binary from GitHub Releases** (once, with a TTL cache on the controller),\n  uploads (or remote-downloads) the matching binary to the target into a persistent directory\n  (e.g. `~/.katmer/bin` on POSIX or `%USERPROFILE%\\.katmer\\bin` on Windows), and runs it with `--format json`.\n- It relies on the provider's pre-detected OS/arch to pick the right asset.\n  If the OS is unknown and [`fallback_when_unknown`](#parameter-fallback_when_unknown) is true,\n  it will **try all supported OS binaries** (linux → darwin → windows) until one succeeds.\n- **Idempotent on target**: if the same fastfetch version already exists on the target path, the binary won't be re-uploaded/re-downloaded.\n- **Cached on controller**: GitHub releases and zip payloads are cached locally under [`cache_dir`](#parameter-cache_dir).\n  Releases are re-queried only after [`release_ttl_days`](#parameter-release_ttl_days) days.\n- Works with both **SSH** and **Local** providers:\n  - SSH: uploads to `~/.katmer/bin/fastfetch[-os].exe` (or remote-downloads if upload fails).\n  - Local: runs the cached controller binary directly (still keeps controller cache/TTL).",
  "parameters": [
    {
      "name": "GatherFactsModuleOptions",
      "type": "GatherFactsModuleOptions",
      "optional": false,
      "description": "You can pass `true` to use sensible defaults with controller caching and target-side persistence.\nIf a string array is provided, it will be used as the `modules` list.",
      "union": {
        "alias": "",
        "branches": [
          {
            "label": "object",
            "fields": [
              {
                "name": "modules",
                "type": "string[]",
                "optional": false,
                "description": "fastfetch modules to fetch. See https://github.com/fastfetch-cli/fastfetch/wiki/Support+Status#available-modules for available modules."
              },
              {
                "name": "version",
                "type": "string",
                "optional": true,
                "description": "GitHub tag to use (e.g., `\"2.16.0\"`).\nIf omitted, the module uses the **latest release**, subject to the local release cache\ncontrolled by [`release_ttl_days`](#parameter-release_ttl_days)."
              },
              {
                "name": "cache_dir",
                "type": "string",
                "optional": true,
                "description": "Directory on the **controller** where release metadata and downloaded zip files are cached."
              },
              {
                "name": "release_ttl_days",
                "type": "number",
                "optional": true,
                "description": "Time-to-live (in days) for the local **release metadata** cache.\nWithin this period, the module avoids querying GitHub’s API again."
              },
              {
                "name": "target_dir",
                "type": "string",
                "optional": true,
                "description": "Persistent directory on the **target** where the fastfetch binary is placed.\nIf the same version already exists there, upload/download is skipped."
              },
              {
                "name": "fallback_when_unknown",
                "type": "boolean",
                "optional": true,
                "description": "When the provider OS cannot be determined, try all supported OS binaries (linux/darwin/windows)\nin that order until one succeeds."
              }
            ]
          },
          {
            "label": "boolean",
            "description": "boolean"
          },
          {
            "label": "string[]",
            "description": "string[]"
          }
        ]
      }
    }
  ],
  "examples": "\n- name: Gather target facts via fastfetch\n  gather_facts:\n    version: \"2.16.0\"              # optional, defaults to cached-latest within TTL\n    cache_dir: \"/var/cache/katmer\" # controller cache for releases & zips\n    release_ttl_days: 3            # only re-check GitHub after 3 days\n    target_dir: \"~/.katmer/bin\"    # where the binary lives on target\n\n- name: Fallback across OSes (OS unknown → try all; darwin wins)\n  gather_facts:\n    fallback_when_unknown: true\n\n- name: Gather facts on localhost\n  targets: local\n  gather_facts:\n    release_ttl_days: 5\n\n",
  "returns": [
    {
      "name": "facts",
      "type": "object",
      "optional": true,
      "description": "Mapped fastfetch `--format json` output to `{ [type|lowercase]: result }`"
    },
    {
      "name": "used_os",
      "type": "\"linux\" | \"darwin\" | \"windows\"",
      "optional": true,
      "description": "Which OS binary ran successfully"
    },
    {
      "name": "version",
      "type": "string",
      "optional": true,
      "description": "Release version/tag used"
    },
    {
      "name": "changed",
      "type": "boolean",
      "optional": true,
      "description": "Whether this module changed anything on the target."
    },
    {
      "name": "failed",
      "type": "boolean",
      "optional": true,
      "description": "Whether the module failed (non-zero exit code, validation failure, etc.)."
    },
    {
      "name": "msg",
      "type": "string",
      "optional": true,
      "description": "Human-readable message describing the outcome or error."
    },
    {
      "name": "stdout",
      "type": "string",
      "optional": true,
      "description": "Captured standard output, if available."
    },
    {
      "name": "stderr",
      "type": "string",
      "optional": true,
      "description": "Captured standard error, if available."
    },
    {
      "name": "start",
      "type": "string",
      "optional": true,
      "description": "ISO8601 timestamp when execution started (best-effort)."
    },
    {
      "name": "end",
      "type": "string",
      "optional": true,
      "description": "ISO8601 timestamp when execution ended (best-effort)."
    },
    {
      "name": "delta",
      "type": "string",
      "optional": true,
      "description": "Duration string, e.g., \"0:00:00.123\" (best-effort)."
    },
    {
      "name": "attempts",
      "type": "number",
      "optional": true,
      "description": "Number of attempts performed so far (e.g., by `until`).\nTypically increments from 1 upwards."
    },
    {
      "name": "retries",
      "type": "number",
      "optional": true,
      "description": "Maximum retries allowed for this operation (e.g., by `until`).\nThis reflects the configured ceiling, not the attempts taken."
    }
  ]
}
